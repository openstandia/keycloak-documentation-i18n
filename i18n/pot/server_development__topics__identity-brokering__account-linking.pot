# SOME DESCRIPTIVE TITLE
# Copyright (C) YEAR Nomura Research Institute, Ltd.
# This file is distributed under the same license as the keycloak-documentation-i18n package.
# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
#
#, fuzzy
msgid ""
msgstr ""
"Project-Id-Version: keycloak-documentation-i18n  \n"
"POT-Creation-Date: 2017-09-20 08:18+0000\n"
"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
"Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
"Language-Team: LANGUAGE <LL@li.org>\n"
"Language: \n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"

#. type: Plain text
#: source/securing_apps/topics/client-registration.adoc:148
#: source/securing_apps/topics/oidc/java/adapter-context.adoc:16
#: source/securing_apps/topics/oidc/java/adapter_error_handling.adoc:24
#: source/securing_apps/topics/oidc/java/multi-tenancy.adoc:17
#: source/securing_apps/topics/saml/java/assertion-api.adoc:11
#: source/server_admin/topics/identity-broker/suggested.adoc:15
#: source/server_admin/topics/identity-broker/suggested.adoc:25
#: source/server_admin/topics/identity-broker/tokens.adoc:12
#: source/server_development/topics/user-storage/augmenting.adoc:15
#: source/server_development/topics/user-storage/augmenting.adoc:47
#: source/server_development/topics/user-storage/cache.adoc:14
#: source/server_development/topics/user-storage/cache.adoc:52
#: source/server_development/topics/user-storage/cache.adoc:63
#: source/server_development/topics/user-storage/configuration.adoc:9
#: source/server_development/topics/user-storage/configuration.adoc:38
#: source/server_development/topics/user-storage/configuration.adoc:66
#: source/server_development/topics/user-storage/configuration.adoc:85
#: source/server_development/topics/user-storage/import.adoc:31
#: source/server_development/topics/user-storage/import.adoc:85
#: source/server_development/topics/user-storage/import.adoc:111
#: source/server_development/topics/user-storage/javaee.adoc:16
#: source/server_development/topics/user-storage/javaee.adoc:60
#: source/server_development/topics/user-storage/model-interfaces.adoc:7
#: source/server_development/topics/user-storage/provider-interfaces.adoc:10
#: source/server_development/topics/user-storage/provider-interfaces.adoc:59
#: source/server_development/topics/user-storage/provider-interfaces.adoc:94
#: source/server_development/topics/user-storage/registration-query.adoc:15
#: source/server_development/topics/user-storage/registration-query.adoc:33
#: source/server_development/topics/user-storage/registration-query.adoc:65
#: source/server_development/topics/user-storage/registration-query.adoc:81
#: source/server_development/topics/user-storage/registration-query.adoc:99
#: source/server_development/topics/user-storage/registration-query.adoc:132
#: source/server_development/topics/user-storage/registration-query.adoc:163
#: source/server_development/topics/user-storage/registration-query.adoc:191
#: source/server_development/topics/user-storage/registration-query.adoc:212
#: source/server_development/topics/user-storage/rest.adoc:16
#: source/server_development/topics/user-storage/rest.adoc:62
#: source/server_development/topics/user-storage/simple-example.adoc:10
#: source/server_development/topics/user-storage/simple-example.adoc:24
#: source/server_development/topics/user-storage/simple-example.adoc:43
#: source/server_development/topics/user-storage/simple-example.adoc:100
#: source/server_development/topics/user-storage/simple-example.adoc:134
#: source/server_development/topics/user-storage/simple-example.adoc:160
#: source/server_development/topics/user-storage/simple-example.adoc:182
#: source/server_development/topics/user-storage/simple-example.adoc:229
#: source/server_development/topics/user-storage/simple-example.adoc:243
#: source/server_development/topics/admin-rest-api.adoc:49
#: source/server_development/topics/auth-spi.adoc:170
#: source/server_development/topics/auth-spi.adoc:186
#: source/server_development/topics/auth-spi.adoc:199
#: source/server_development/topics/auth-spi.adoc:231
#: source/server_development/topics/auth-spi.adoc:259
#: source/server_development/topics/auth-spi.adoc:287
#: source/server_development/topics/auth-spi.adoc:310
#: source/server_development/topics/auth-spi.adoc:327
#: source/server_development/topics/auth-spi.adoc:341
#: source/server_development/topics/auth-spi.adoc:383
#: source/server_development/topics/auth-spi.adoc:437
#: source/server_development/topics/auth-spi.adoc:452
#: source/server_development/topics/auth-spi.adoc:474
#: source/server_development/topics/auth-spi.adoc:498
#: source/server_development/topics/auth-spi.adoc:546
#: source/server_development/topics/auth-spi.adoc:585
#: source/server_development/topics/auth-spi.adoc:625
#: source/server_development/topics/auth-spi.adoc:681
#: source/server_development/topics/auth-spi.adoc:708
#: source/server_development/topics/extensions.adoc:21
#: source/server_development/topics/extensions.adoc:41
#: source/server_development/topics/extensions.adoc:99
#: source/server_development/topics/extensions.adoc:130
#: source/server_development/topics/providers.adoc:18
#: source/server_development/topics/providers.adoc:53
#: source/server_development/topics/providers.adoc:111
#: source/server_development/topics/providers.adoc:121
#: source/server_development/topics/providers.adoc:157
#: source/server_development/topics/providers.adoc:279
#: source/server_development/topics/providers.adoc:323
#: source/server_development/topics/identity-brokering/account-linking.adoc:24
#: source/server_development/topics/identity-brokering/account-linking.adoc:54
#: source/server_development/topics/identity-brokering/tokens.adoc:12
#, no-wrap
msgid "[source,java]\n"
msgstr ""

#. type: Title ===
#: source/server_development/topics/identity-brokering/account-linking.adoc:2
#, no-wrap
msgid "Client Initiated Account Linking"
msgstr ""

#. type: Plain text
#: source/server_development/topics/identity-brokering/account-linking.adoc:7
#, no-wrap
msgid ""
"Some applications want to integrate with social providers like Facebook, but do not want to provide an option to login via\n"
"these social providers.  {project_name} offers a browser-based API that applications can use to link an existing\n"
"user account to a specific external IDP.  This is called client initiated account linking.\n"
msgstr ""

#. type: Plain text
#: source/server_development/topics/identity-brokering/account-linking.adoc:12
#, no-wrap
msgid ""
"The way it works is that the application forward's the user's browser to a URL on the {project_name} server requesting\n"
"that it wants to link the user's account to a specific external provider (i.e. Facebook).  The server\n"
"initiates a login with the external provider.  The browser logs in at the external provider and is redirected\n"
"back to the auth server.  The auth server establishes the link and redirects back to the application with a confirmation.\n"
msgstr ""

#. type: Plain text
#: source/server_development/topics/identity-brokering/account-linking.adoc:14
#, no-wrap
msgid "There are some preconditions that must be met by the client application before it can initiate this protocol:\n"
msgstr ""

#. type: Plain text
#: source/server_development/topics/identity-brokering/account-linking.adoc:16
#, no-wrap
msgid "The desired identity provider must be configured and enabled for the user's realm in the admin console.\n"
msgstr ""

#. type: Plain text
#: source/server_development/topics/identity-brokering/account-linking.adoc:17
#, no-wrap
msgid "The application must already be logged in as an existing user via the OIDC protocol\n"
msgstr ""

#. type: Plain text
#: source/server_development/topics/identity-brokering/account-linking.adoc:18
#, no-wrap
msgid "The user must have an `account.manage-account` or `account.manage-account-links` role mapping.\n"
msgstr ""

#. type: Plain text
#: source/server_development/topics/identity-brokering/account-linking.adoc:19
#, no-wrap
msgid "The application must be granted the scope for those roles within its access token\n"
msgstr ""

#. type: Plain text
#: source/server_development/topics/identity-brokering/account-linking.adoc:20
#, no-wrap
msgid "The application must have access to its access token as it needs information within it to generate the redirect URL.\n"
msgstr ""

#. type: Plain text
#: source/server_development/topics/identity-brokering/account-linking.adoc:22
#, no-wrap
msgid "To initiate the login, the application must fabricate a URL and redirect the user's browser to this URL.  The URL looks like this:\n"
msgstr ""

#. type: delimited block -
#: source/server_development/topics/identity-brokering/account-linking.adoc:26
#, no-wrap
msgid "/{auth-server-root}/auth/realms/{realm}/broker/{provider}/link?client_id={id}&redirect_uri={uri}&nonce={nonce}&hash={hash}\n"
msgstr ""

#. type: Plain text
#: source/server_development/topics/identity-brokering/account-linking.adoc:29
#, no-wrap
msgid "Here's a description of each path and query param:\n"
msgstr ""

#. type: Labeled list
#: source/server_development/topics/identity-brokering/account-linking.adoc:30
#, no-wrap
msgid "provider"
msgstr ""

#. type: Plain text
#: source/server_development/topics/identity-brokering/account-linking.adoc:32
#, no-wrap
msgid "This is the provider alias of the external IDP that you defined in the `Identity Provider` section of the admin console.\n"
msgstr ""

#. type: Labeled list
#: source/server_development/topics/identity-brokering/account-linking.adoc:33
#, no-wrap
msgid "client_id"
msgstr ""

#. type: Plain text
#: source/server_development/topics/identity-brokering/account-linking.adoc:36
#, no-wrap
msgid ""
"This is the OIDC client id of your application.  When you registered the application as a client in the admin console,\n"
"you had to specify this client id.\n"
msgstr ""

#. type: Labeled list
#: source/server_development/topics/identity-brokering/account-linking.adoc:37
#, no-wrap
msgid "redirect_uri"
msgstr ""

#. type: Plain text
#: source/server_development/topics/identity-brokering/account-linking.adoc:41
#, no-wrap
msgid ""
"This is the application callback URL you want to redirect to after the account link is established.  It must be a valid\n"
"client redirect URI pattern.  In other words, it must match one of the valid URL patterns you defined when you registered\n"
"the client in the admin console.\n"
msgstr ""

#. type: Labeled list
#: source/server_development/topics/identity-brokering/account-linking.adoc:42
#, no-wrap
msgid "nonce"
msgstr ""

#. type: Plain text
#: source/server_development/topics/identity-brokering/account-linking.adoc:44
#, no-wrap
msgid "This is a random string that your application must generate\n"
msgstr ""

#. type: Labeled list
#: source/server_development/topics/identity-brokering/account-linking.adoc:45
#, no-wrap
msgid "hash"
msgstr ""

#. type: Plain text
#: source/server_development/topics/identity-brokering/account-linking.adoc:49
#, no-wrap
msgid ""
"This is a Base64 URL encoded hash.  This hash is generated by Base64 URL encoding a SHA_256 hash of `nonce` + `token.getSessionState()` + `token.getIssuedFor()` + `provider`\n"
"The token variable are obtained from the OIDC access token.  Basically you are hashing the random nonce, the user session id, the client id, and the identity\n"
"provider alias you want to access.\n"
msgstr ""

#. type: Plain text
#: source/server_development/topics/identity-brokering/account-linking.adoc:51
#, no-wrap
msgid "Here's an example of Java Servlet code that generates the URL to establish the account link.\n"
msgstr ""

#. type: delimited block -
#: source/server_development/topics/identity-brokering/account-linking.adoc:76
#, no-wrap
msgid ""
"   KeycloakSecurityContext session = (KeycloakSecurityContext) httpServletRequest.getAttribute(KeycloakSecurityContext.class.getName());\n"
"   AccessToken token = session.getToken();\n"
"   String clientId = token.getIssuedFor();\n"
"   String nonce = UUID.randomUUID().toString();\n"
"   MessageDigest md = null;\n"
"   try {\n"
"      md = MessageDigest.getInstance(\"SHA-256\");\n"
"   } catch (NoSuchAlgorithmException e) {\n"
"      throw new RuntimeException(e);\n"
"   }\n"
"   String input = nonce + token.getSessionState() + clientId + provider;\n"
"   byte[] check = md.digest(input.getBytes(StandardCharsets.UTF_8));\n"
"   String hash = Base64Url.encode(check);\n"
"   request.getSession().setAttribute(\"hash\", hash);\n"
"   String redirectUri = ...;\n"
"   String accountLinkUrl = KeycloakUriBuilder.fromUri(authServerRootUrl)\n"
"                    .path(\"/auth/realms/{realm}/broker/{provider}/link\")\n"
"                    .queryParam(\"nonce\", nonce)\n"
"                    .queryParam(\"hash\", hash)\n"
"                    .queryParam(\"client_id\", clientId)\n"
"                    .queryParam(\"redirect_uri\", redirectUri).build(realm, provider).toString();\n"
msgstr ""

#. type: Plain text
#: source/server_development/topics/identity-brokering/account-linking.adoc:81
#, no-wrap
msgid ""
"Why is this hash included?  We do this so that the auth server is guaranteed to know that the client application initiated the request and no other rogue app\n"
"just randomly asked for a user account to be linked to a specific provider.  The auth server will first check to see if the user is logged in by checking the SSO\n"
"cookie set at login.  It will then try to regenerate the hash based on the current login and match it up to the hash sent by the application.\n"
msgstr ""

#. type: Plain text
#: source/server_development/topics/identity-brokering/account-linking.adoc:86
#, no-wrap
msgid ""
"After the account has been linked, the auth server will redirect back to the `redirect_uri`.  If there is a problem servicing the link request,\n"
"the auth server may or may not redirect back to the `redirect_uri`.  The browser may just end up at an error page instead of being redirected back\n"
"to the application.  If there is an error condition and the auth server deems it safe enough to redirect back to the client app, an additional\n"
"`error` query parameter will be appended to the `redirect_uri`.\n"
msgstr ""

#. type: Plain text
#: source/server_development/topics/identity-brokering/account-linking.adoc:90
#, no-wrap
msgid ""
"   While this API guarantees that the application initiated the request, it does not completely prevent CSRF attacks for this operation.  The application\n"
"   is still responsible for guarding against CSRF attacks target at itself.\n"
msgstr ""

#. type: Title ====
#: source/server_development/topics/identity-brokering/account-linking.adoc:91
#, no-wrap
msgid "Refreshing External Tokens"
msgstr ""

#. type: Plain text
#: source/server_development/topics/identity-brokering/account-linking.adoc:94
#, no-wrap
msgid "If you are using the external token generated by logging into the provider (i.e. a Facebook or Github token), you can refresh this token by re-initiating the account linking API.\n"
msgstr ""
